"use strict";const e=uniCloud.database(),t=e.collection("news"),a=e.collection("news-category"),s=e.collection("news-tag");function n(){"development"===process.env.NODE_ENV&&console.log(...arguments)}const o=uniCloud.database();const d=uniCloud.database();const c=uniCloud.database();var r={newsList:async function(e){try{n("newsList -> params",e);let a={},s=["_id","desc"];e.sort&&(s=e.sort);let d=e.page.index,c=e.page.size;d<1&&(d=1),c<1&&(c=10);let r={_id:o.command.neq("")};e.keyword&&""!==e.keyword&&(r=Object.assign({title:new RegExp(".*"+e.keyword,"i")},r)),e.categoryId&&""!==e.categoryId&&(r=Object.assign({categoryId:e.categoryId},r)),e.status&&""!==e.status&&(r=Object.assign({status:e.status},r)),e.tag&&""!==e.tag&&(r=Object.assign({tag:new RegExp(".*"+e.tag,"i")},r)),n("newsList -> query",r);let i=0;const g=await t.where(r).count();g&&g.total>0&&(i=g.total),n("newsList -> countRes",g);const w=await t.where(r).skip((d-1)*c).limit(c).orderBy(...s).get();return a=w,n("newsList -> listRes",w),{code:0,msg:"成功",data:{total:i,rows:a}}}catch(e){return n("发生异常",e),{code:1104,msg:"数据库写入异常"}}},newsDetail:async function(e){try{n("newsDetail -> params",e);let a={};const s=await t.doc(e.id).get();return a=s.data[0],n("newsDetail -> detailRes",s),{code:0,msg:"成功",data:a}}catch(e){return n("发生异常",e),{code:1104,msg:"数据库写入异常"}}},newsDelete:async function(e){try{n("newsDelete -> params",e);let a={};const s=await t.doc(e.id).remove();return a=s,n("newsDelete -> removeRes",s),{code:0,msg:"成功",data:a}}catch(e){return n("发生异常",e),{code:1104,msg:"数据库写入异常"}}},newsAdd:async function(e){try{n("newsAdd -> params",e);const a=e.model;let s={};const o=await t.add(a);return s=o,n("newsAdd -> addRes",o),{code:0,msg:"成功",data:s}}catch(e){return n("发生异常",e),{code:1104,msg:"数据库写入异常"}}},newsUpdate:async function(e){try{n("newsUpdate -> params",e);const a=e.model;let s={};const o=await t.doc(e.id).update(a);return s=o,n("newsUpdate -> updateRes",o),{code:0,msg:"成功",data:s}}catch(e){return n("发生异常",e),{code:1104,msg:"数据库写入异常"}}},newsCategoryList:async function(e){try{n("newsCategoryList -> params",e);let t={},s=["_id","desc"];e.sort&&(s=e.sort);let o=e.page.index,c=e.page.size;o<1&&(o=1),c<1&&(c=10);let r={_id:d.command.neq("")};e.keyword&&""!==e.keyword&&(r=Object.assign({name:new RegExp(".*"+e.keyword,"i")},r)),e.parentId&&""!==e.parentId&&(r=Object.assign({parentId:e.parentId},r)),e.status&&""!==e.status&&(r=Object.assign({status:e.status},r)),n("newsCategoryList -> query",r);let i=0;const g=await a.where(r).count();g&&g.total>0&&(i=g.total),n("newsCategoryList -> countRes",g);const w=await a.where(r).skip((o-1)*c).limit(c).orderBy(...s).get();return t=w,n("newsCategoryList -> listRes",w),{code:0,msg:"成功",data:{total:i,rows:t}}}catch(e){return n("发生异常",e),{code:1104,msg:"数据库写入异常"}}},newsCategoryDetail:async function(e){try{n("newsCategoryDetail -> params",e);let t={};const s=await a.doc(e.id).get();return t=s.data[0],n("newsCategoryDetail -> detailRes",s),{code:0,msg:"成功",data:t}}catch(e){return n("发生异常",e),{code:1104,msg:"数据库写入异常"}}},newsCategoryDelete:async function(e){try{n("newsCategoryDelete -> params",e);let t={};const s=await a.doc(e.id).remove();return t=s,n("newsCategoryDelete -> removeRes",s),{code:0,msg:"成功",data:t}}catch(e){return n("发生异常",e),{code:1104,msg:"数据库写入异常"}}},newsCategoryAdd:async function(e){try{n("newsCategoryAdd -> params",e);const t=e.model;let s={};const o=await a.add(t);return s=o,n("newsCategoryAdd -> addRes",o),{code:0,msg:"成功",data:s}}catch(e){return n("发生异常",e),{code:1104,msg:"数据库写入异常"}}},newsCategoryUpdate:async function(e){try{n("newsCategoryUpdate -> params",e);const t=e.model;let s={};const o=await a.doc(e.id).update(t);return s=o,n("newsCategoryUpdate -> updateRes",o),{code:0,msg:"成功",data:s}}catch(e){return n("发生异常",e),{code:1104,msg:"数据库写入异常"}}},newsTagList:async function(e){try{n("newsTagList -> params",e);let t={},a=["_id","desc"];e.sort&&(a=e.sort);let o=e.page.index,d=e.page.size;o<1&&(o=1),d<1&&(d=10);let r={_id:c.command.neq("")};e.keyword&&""!==e.keyword&&(r=Object.assign({name:new RegExp(".*"+e.keyword,"i")},r)),e.status&&""!==e.status&&(r=Object.assign({status:e.status},r)),n("newsTagList -> query",r);let i=0;const g=await s.where(r).count();g&&g.total>0&&(i=g.total),n("newsTagList -> countRes",g);const w=await s.where(r).skip((o-1)*d).limit(d).orderBy(...a).get();return t=w,n("newsTagList -> listRes",w),{code:0,msg:"成功",data:{total:i,rows:t}}}catch(e){return n("发生异常",e),{code:1104,msg:"数据库写入异常"}}},newsTagDetail:async function(e){try{n("newsTagDetail -> params",e);let t={};const a=await s.doc(e.id).get();return t=a.data[0],n("newsTagDetail -> detailRes",a),{code:0,msg:"成功",data:t}}catch(e){return n("发生异常",e),{code:1104,msg:"数据库写入异常"}}},newsTagDelete:async function(e){try{n("newsTagDelete -> params",e);let t={};const a=await s.doc(e.id).remove();return t=a,n("newsTagDelete -> removeRes",a),{code:0,msg:"成功",data:t}}catch(e){return n("发生异常",e),{code:1104,msg:"数据库写入异常"}}},newsTagAdd:async function(e){try{n("newsTagAdd -> params",e);const t=e.model;let a={};const o=await s.add(t);return a=o,n("newsTagAdd -> addRes",o),{code:0,msg:"成功",data:a}}catch(e){return n("发生异常",e),{code:1104,msg:"数据库写入异常"}}},newsTagUpdate:async function(e){try{n("newsTagUpdate -> params",e);const t=e.model;let a={};const o=await s.doc(e.id).update(t);return a=o,n("newsTagUpdate -> updateRes",o),{code:0,msg:"成功",data:a}}catch(e){return n("发生异常",e),{code:1104,msg:"数据库写入异常"}}}};module.exports=r;
