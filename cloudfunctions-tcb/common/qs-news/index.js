"use strict";const t=uniCloud.database(),e=t.collection("news");t.collection("news-category"),t.collection("news-tag");function s(){"development"===process.env.NODE_ENV&&console.log(...arguments)}const o=uniCloud.database();var a={newsList:async function(t){try{s("newsList -> params",t);let a={},n=["_id","desc"];t.sort&&(n=t.sort);let c=t.page.index,i=t.page.size;c<1&&(c=1),i<1&&(i=10);let r={_id:o.command.neq("")};t.keyword&&""!==t.keyword&&(r=Object.assign({title:new RegExp(".*"+t.keyword,"i")},r)),t.categoryId&&""!==t.categoryId&&(r=Object.assign({categoryId:t.categoryId},r)),t.status&&""!==t.status&&(r=Object.assign({status:t.status},r)),s("newsList -> query",r);let d=0;const l=await e.where(r).count();l&&l.total>0&&(d=l.total),s("newsList -> countRes",l);const u=await e.where(r).skip((c-1)*i).limit(i).orderBy(...n).get();return a=u,s("newsList -> listRes",u),{code:0,msg:"获取成功",data:{total:d,rows:a}}}catch(t){return s("发生异常",t),{code:1104,msg:"数据库写入异常"}}}};module.exports=a;
