"use strict";function e(){"development"===process.env.NODE_ENV&&console.log(...arguments)}const t=uniCloud.database(),s=t.collection("news"),a=t.collection("news-category"),n=t.collection("news-tag"),d=uniCloud.database();const o=uniCloud.database();const c=uniCloud.database();const r=uniCloud.database();const i=uniCloud.database();const g=uniCloud.database();var u={newsList:async function(t){try{e("newsList -> params",t);let a={},n=["_id","desc"];t.sort&&(n=t.sort);const o={index:1,size:10};t.page&&(o.index=t.page.index,o.size=t.page.size);let c={_id:d.command.neq("")};t.keyword&&""!==t.keyword&&(c=Object.assign({title:new RegExp(".*"+t.keyword,"i")},c)),t.categoryId&&""!==t.categoryId&&(c=Object.assign({categoryId:t.categoryId},c)),t.status&&""!==t.status&&(c=Object.assign({status:t.status},c)),t.tag&&""!==t.tag&&(c=Object.assign({tag:new RegExp(".*"+t.tag,"i")},c)),e("newsList -> query",c);let r=0;const i=await s.where(c).count();i&&i.total>0&&(r=i.total),e("newsList -> countRes",i);const g=await s.where(c).skip((o.index-1)*o.size).limit(o.size).orderBy(...n).get();return e("newsList -> liRes",g),a=g.data,{code:0,msg:"成功",data:{total:r,rows:a}}}catch(t){return e("发生异常",t),{code:90001,msg:"数据库异常"}}},newsDetail:async function(t){try{e("newsDetail -> params",t);let a={};const n=t.id;if(!n)return{code:80101,msg:"缺少 id 参数"};const d=await s.doc(n).get();return e("newsDetail -> deRes",d),d&&d.data&&d.data.length>0?(a=d.data[0],{code:0,msg:"成功",data:a}):{code:10101,msg:"该记录不存在"}}catch(t){return e("发生异常",t),{code:90001,msg:"数据库异常"}}},newsAdd:async function(t){try{e("newsAdd -> params",t);const a=t.model,n=await s.add(a);e("newsAdd -> addRes",n);const d=n.id;return d?{code:0,msg:"新增成功",data:{id:d}}:{code:70401,msg:"新增失败，请稍后再试"}}catch(t){return e("发生异常",t),{code:90001,msg:"数据库异常"}}},newsUpdate:async function(t){try{e("newsUpdate -> params",t);const a=t.model;let n={};const d=t.id;if(!d)return{code:80101,msg:"缺少 id 参数"};const o=await s.doc(d).update(a);return e("newsUpdate -> upRes",o),n=o,1===o.updated?{code:0,msg:"更新成功",data:n}:{code:70401,msg:"更新失败，请稍后再试"}}catch(t){return e("发生异常",t),{code:90001,msg:"数据库异常"}}},newsDelete:async function(t){try{e("newsDelete -> params",t);let a={};const n=t.id;if(!n)return{code:80101,msg:"缺少 id 参数"};const d=await s.doc(n).remove();return e("newsDelete -> reRes",d),a=d,{code:0,msg:"删除成功",data:a}}catch(t){return e("发生异常",t),{code:90001,msg:"数据库异常"}}},newsEmpty:async function(){try{let t={};const a=o.command,n=await s.where({_id:a.exists(!0)}).remove();return e("newsEmpty -> reRes",n),t=n,{code:0,msg:"清空成功",data:t}}catch(t){return e("发生异常",t),{code:90001,msg:"数据库异常"}}},newsCategoryList:async function(t){try{e("newsCategoryList -> params",t);let s={},n=["_id","desc"];t.sort&&(n=t.sort);const d={index:1,size:10};t.page&&(d.index=t.page.index,d.size=t.page.size);let o={_id:c.command.neq("")};t.keyword&&""!==t.keyword&&(o=Object.assign({name:new RegExp(".*"+t.keyword,"i")},o)),t.parentId&&""!==t.parentId&&(o=Object.assign({parentId:t.parentId},o)),t.status&&""!==t.status&&(o=Object.assign({status:t.status},o)),e("newsCategoryList -> query",o);let r=0;const i=await a.where(o).count();i&&i.total>0&&(r=i.total),e("newsCategoryList -> countRes",i);const g=await a.where(o).skip((d.index-1)*d.size).limit(d.size).orderBy(...n).get();return e("newsCategoryList -> liRes",g),s=g.data,{code:0,msg:"成功",data:{total:r,rows:s}}}catch(t){return e("发生异常",t),{code:90001,msg:"数据库异常"}}},newsCategoryDetail:async function(t){try{e("newsCategoryDetail -> params",t);let s={};const n=t.id;if(!n)return{code:80101,msg:"缺少 id 参数"};const d=await a.doc(n).get();return e("newsCategoryDetail -> deRes",d),d&&d.data&&d.data.length>0?(s=d.data[0],{code:0,msg:"成功",data:s}):{code:10101,msg:"该记录不存在"}}catch(t){return e("发生异常",t),{code:90001,msg:"数据库异常"}}},newsCategoryAdd:async function(t){try{e("newsCategoryAdd -> params",t);const s=t.model,n=await a.add(s);e("newsAdd -> addRes",n);const d=n.id;return d?{code:0,msg:"新增成功",data:{id:d}}:{code:70401,msg:"新增失败，请稍后再试"}}catch(t){return e("发生异常",t),{code:90001,msg:"数据库异常"}}},newsCategoryUpdate:async function(t){try{e("newsCategoryUpdate -> params",t);const s=t.model;let n={};const d=t.id;if(!d)return{code:80101,msg:"缺少 id 参数"};const o=await a.doc(d).update(s);return e("newsUpdate -> upRes",o),n=o,1===o.updated?{code:0,msg:"更新成功",data:n}:{code:70401,msg:"更新失败，请稍后再试"}}catch(t){return e("发生异常",t),{code:90001,msg:"数据库异常"}}},newsCategoryDelete:async function(t){try{e("newsCategoryDelete -> params",t);let s={};const n=t.id;if(!n)return{code:80101,msg:"缺少 id 参数"};const d=await a.doc(n).remove();return e("newsCategoryDelete -> reRes",d),s=d,{code:0,msg:"删除成功",data:s}}catch(t){return e("发生异常",t),{code:90001,msg:"数据库异常"}}},newsCategoryEmpty:async function(){try{let t={};const s=r.command,n=await a.where({_id:s.exists(!0)}).remove();return e("newsCategoryEmpty -> reRes",n),t=n,{code:0,msg:"清空成功",data:t}}catch(t){return e("发生异常",t),{code:90001,msg:"数据库异常"}}},newsTagList:async function(t){try{e("newsTagList -> params",t);let s={},a=["_id","desc"];t.sort&&(a=t.sort);const d={index:1,size:10};t.page&&(d.index=t.page.index,d.size=t.page.size);let o={_id:i.command.neq("")};t.keyword&&""!==t.keyword&&(o=Object.assign({name:new RegExp(".*"+t.keyword,"i")},o)),t.status&&""!==t.status&&(o=Object.assign({status:t.status},o)),e("newsTagList -> query",o);let c=0;const r=await n.where(o).count();r&&r.total>0&&(c=r.total),e("newsTagList -> countRes",r);const g=await n.where(o).skip((d.index-1)*d.size).limit(d.size).orderBy(...a).get();return e("newsTagList -> liRes",g),s=g.data,{code:0,msg:"成功",data:{total:c,rows:s}}}catch(t){return e("发生异常",t),{code:90001,msg:"数据库异常"}}},newsTagDetail:async function(t){try{e("newsTagDetail -> params",t);let s={};const a=t.id;if(!a)return{code:80101,msg:"缺少 id 参数"};const d=await n.doc(a).get();return e("newsTagDetail -> deRes",d),d&&d.data&&d.data.length>0?(s=d.data[0],{code:0,msg:"成功",data:s}):{code:10101,msg:"该记录不存在"}}catch(t){return e("发生异常",t),{code:90001,msg:"数据库异常"}}},newsTagAdd:async function(t){try{e("newsTagAdd -> params",t);const s=t.model,a=await n.add(s);e("newsAdd -> addRes",a);const d=a.id;return d?{code:0,msg:"新增成功",data:{id:d}}:{code:70401,msg:"新增失败，请稍后再试"}}catch(t){return e("发生异常",t),{code:90001,msg:"数据库异常"}}},newsTagUpdate:async function(t){try{e("newsTagUpdate -> params",t);const s=t.model;let a={};const d=t.id;if(!d)return{code:80101,msg:"缺少 id 参数"};const o=await n.doc(d).update(s);return e("newsUpdate -> upRes",o),a=o,1===o.updated?{code:0,msg:"更新成功",data:a}:{code:70401,msg:"更新失败，请稍后再试"}}catch(t){return e("发生异常",t),{code:90001,msg:"数据库异常"}}},newsTagDelete:async function(t){try{e("newsTagDelete -> params",t);let s={};const a=t.id;if(!a)return{code:80101,msg:"缺少 id 参数"};const d=await n.doc(a).remove();return e("newsTagDelete -> reRes",d),s=d,{code:0,msg:"删除成功",data:s}}catch(t){return e("发生异常",t),{code:90001,msg:"数据库异常"}}},newsTagEmpty:async function(){try{let t={};const s=g.command,a=await n.where({_id:s.exists(!0)}).remove();return e("newsTagEmpty -> reRes",a),t=a,{code:0,msg:"清空成功",data:t}}catch(t){return e("发生异常",t),{code:90001,msg:"数据库异常"}}}};module.exports=u;
